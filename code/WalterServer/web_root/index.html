<!DOCTYPE HTML>
<html>
    <head>
    <script src="webix.js" type="text/javascript"></script>  
    <link href="skins/flat.css" rel="stylesheet" type="text/css">

    </head>
    <body>
          <div id="htmlContainer"></div>

        <script type="text/javascript" charset="utf-8">

  webix.ready(function(){
    grida = webix.ui({
    container:"htmlContainer",
    type:"line",
    view:"layout", 
        rows: [
          {view:"template", type :"header", template:"Walters Cerebellum"},
          { cols:[ //2nd row
              { view:"list", datatype:"json", id:"cortexcmd", label:"Cortex Command", template:"#line#", labelPosition:"top", value:"<no value>", url:"web?key=cortexcmd" },
              { view:"list", datatype:"json", id:"cortexlog", label:"Cortex Log",      template:"#line#", labelPosition:"top",  value:"<no value>", url:"web?key=cortexlog"},
          ], height:300}, 

          { cols:[
            { view:"form", elements:[
                { view:"text", id:"cortexcmdid", type:"form", placeholder:">Key in Cortex Command",
                    on:{'onKeyPress': function(id){ 
                                        if (id==13) {
                                          webix.ajax().get("/web?action=savecmd&value=" + $$('cortexcmdid').getValue());
                                          $$('cortexcmdid').setValue('');
                                          $$('cortexcmd').load("web?key=cortexcmd&from=" + $$('cortexcmd').getLastId());
                                        }
                                      }
                      }
                },
                { view:"toolbar", id:"execoolbar", elements:[
                  { view:"button", type:"form", label:"Startup", type:"iconButton", icon:"chevron-up"},
                  { view:"button", type:"form", label:"Teardown", type:"iconButton", icon:"chevron-down" },
                  { view:"button", type:"form", label:"Nullposition", type:"iconButton", icon:"arrows-alt"}]
                }
            ]},
            {
                view:"datatable", 
                template:"#title# #options#", // which data to show
                select:false, //enables selection 
                height:400,
                autoConfig:true,
                columns:[
                  { id:"title",    header:"Command",     width:100},
                  { id:"options",   header:"Options",    width:500}
                  ],
                data: [
                    {  id:1, title:"LED", options: "on | off | blink"},
                    {  id:2,title:"POWER", options: "on | off"},
                    {  id:3,title:"ENABLE", options: "none"},
                    {  id:4,title:"DISABLE", options: "none"},
                    {  id:5,title:"SETUP", options: "none"},
                    {  id:6,title:"SET", options: "<actuator> [min=x] [max=x] [null=x] [P=x] [I=x] [D=x] [speed=x] [acc=x]"},
                    {  id:7,title:"MEM", options: "reset | list"},
                    {  id:8,title:"INFO", options: "none"}
                ]
            } 
          ]}
        ]
  });
})

        // refresh log file viewer every second
        setInterval(function() {  $$('cortexlog').load("web?key=cortexlog&from=" + $$('cortexlog').getLastId());},  100000);
 
        // find out the current alert number
        var fromIdx = 0;
        webix.ajax("web?key=alert", function(text){ fromIdx = Number(text); });

        setInterval(function() {   
                        webix.ajax().get("/web?key=alert&from="+fromIdx, 
                            function(text){ 
                              if (text != "") {
                                 webix.message({title:"Alert", type:'error', text:text, expire:10000 });
                                 fromIdx = Number(fromIdx)+1;
                              }
                            });
                    },  1000);

        </script>
    </body>
</html>