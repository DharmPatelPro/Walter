<!DOCTYPE HTML>
<html>
    <head>
    <script src="webix.js" type="text/javascript"></script>  
    <link href="skins/glamour.css" rel="stylesheet" type="text/css">

    </head>
    <body>
          <div align="center" id="htmlContainer"></div>

        <script type="text/javascript" charset="utf-8">

  webix.ready(function(){
    grida = webix.ui({
    container:"htmlContainer",
    type:"line",
    view:"layout",
    maxWidth:1400,
    rows: [
          {view:"toolbar", 
           elements:[
                  { view:"label",  label:"WALTERS CEREBELLUM", align:"center"},
                  { view:"icon", id:"heartbeat-on", label:"heartbeat", type:"iconButton", icon:"heart", hidden:true },
                  { view:"icon", id:"heartbeat-off", label:"heartbeat", type:"iconButton", icon:"heart-o", hidden:false }
                ]
          },

          // left windows with command history, right window with log file viewer
          { cols:[ 
              { view:"list", datatype:"json", id:"cortexcmd", label:"Cortex Command", template:"#line#", labelPosition:"top", value:"<no value>", url:"web?key=cortexcmd" },
              { view:"list", datatype:"json", id:"cortexlog", label:"Cortex Log",     template:"#line#", labelPosition:"top",  value:"<no value>", url:"web?key=cortexlog"},
          ], height:300}, 

          // left column has a input field for cortex command, right column has help textes
          { cols:[
            { view:"form", elements:[
                { view:"text", id:"cortexcmdid", type:"form", label:"CORTEX>", labelWidth:80, placeholder:"Key in cortex command. H for help.",
                    on:{'onKeyPress': function(id){ 
                                        if (id==13) {
                                          webix.ajax().get("/web?action=savecmd&value=" + $$('cortexcmdid').getValue());
                                          $$('cortexcmdid').setValue('');
                                          $$('cortexcmd').load("web?key=cortexcmd&from=" + $$('cortexcmd').getLastId());
                                        }
                                      }
                      }
                },
                { view:"toolbar",  elements:[
                  { view:"label", id:"botisuplabel" , label:"Bot is down", labelPosition:"left", align:"left"},
                  { view:"button", id:"startupbutton",  label:"Startup", type:"iconButton", icon:"chevron-up", align:"right",
                      on:{'OnItemClick': function(id){ webix.ajax().get("/executor/startupbot"); }}},
                  { view:"button", id:"teardownbutton", label:"Teardown", type:"iconButton", icon:"chevron-down",  align:"right", hidden:"true",
                      on:{'OnItemClick': function(id){ webix.ajax().get("/executor/teardownbot"); }}},
                  { view:"button", id:"nullpositionbutton", label:"Nullposition", type:"iconButton", icon:"arrows-alt", disabled:"true",
                      on:{'OnItemClick': function(id){ webix.ajax().get("/executor/nullpositionbot"); }}},
                  ]
                },
                { view:"toolbar",  elements:[
                  { view:"button", id:"emergencystopbutton",  label:"Emergency Stop", type:"danger", icon:"power-off",
                      on:{'OnItemClick': function(id){ webix.ajax().get("/executor/emergencystop"); }}}
                  ]
                }

            ]},
            {
                view:"datatable", 
                template:"#title# #options#", // which data to show
                select:false, //enables selection 
                height:300,
                autoConfig:true,
                columns:[
                  { id:"title",    header:"Command",     width:100},
                  { id:"options",   header:"Options",    width:500}
                  ],
                data: [
                    {  id:1, title:"LED", options: "<small>on | off | blink</small>"},
                    {  id:2,title:"POWER", options: "<small>on | off</small>"},
                    {  id:3,title:"ENABLE", options: "<small>none</small>"},
                    {  id:4,title:"DISABLE", options: "<small>none</small>"},
                    {  id:5,title:"SETUP", options: "<small>none</small>"},
                    {  id:6,title:"KNOB", options: "<small>&lt;ActuatorNo&gt;</small>"},
                    {  id:7,title:"STEP", options: "<small>&lt;ActuatorNo&gt; &lt;increment&gt;</small>"},
                    {  id:8,title:"CHECKSUM", options: "<small>&lt;on|off&gt;</small>"},
                    {  id:9,title:"MEM", options: "<small>reset | list</small>"},
                    {  id:10,title:"SET", options: "<small>&lt;actuator&gt; [min=x] [max=x] [acc=x] [null=x] [P=x] [I=x] [D=x] [speed=x] </small>"},
                    {  id:11,title:"GET", options: "<small>&lt;actuator&gt;</small>"},
                    {  id:12,title:"MOVETO", options: "<small>&lt;angle1&gt; &lt;angle2&gt; ... &lt;angle7&gt; &lt;durationMS&gt;</small>"},
                    {  id:13,title:"LOG", options: "<small>&lt;setup | servo | stepper | encoder | loop&gt; &lt;on | off&gt;</small>"},
                    {  id:14,title:"CHECKSUM", options: "<small>&lt;on|off></small>"},
                    {  id:15,title:"INFO", options: "<small>none</small>"}
                ]
            } 
          ]}
        ]
  });
});



        // find the id of the latest alert. Only newer alerts are displayed
        var alertFromId = 0; 
        webix.ajax("web?key=alert", function(text){ alertFromId = Number(text); });

        // heartbeat is set to 1 for one second whenever the server reports a successful call 
        var heartbeatOn = 0;

        setInterval(function() {   
                        // check for pending alerts
                        webix.ajax().get("/web?key=alert&from="+alertFromId, 
                            function(text){ 
                              if (text != "") {
                                 webix.message({title:"Alert", type:'error', text:text, expire:10000 });
                                 alertFromId = Number(alertFromId)+1;
                              }
                            }
                        );

                        // update log view
                        $$('cortexlog').load("web?key=cortexlog&from=" + $$('cortexlog').getLastId());

                        // check server if a sucessful call to cortex happened
                        if (heartbeatOn == 1) {
                            $$('heartbeat-on').hide();
                            $$('heartbeat-off').show();
                            heartbeatOn = 0;
                        } else {
                            webix.ajax().get("/web?key=heartbeat", 
                            function(text){ 
                              if (text != "")  {
                                heartbeatOn = 1;
                                $$('heartbeat-on').show();
                                $$('heartbeat-off').hide();
                              }
                            });
                        };

                        webix.ajax().get("/executor/isupandrunning",  function(text){ 
                              if (text == "true") {
                                  $$('startupbutton').hide(); 
                                  $$('teardownbutton').show(); 
                                  $$('nullpositionbutton').enable(); 
                                  $$('botisuplabel').define({ label: "<b>Bot is up" });
                              } 
                              if (text == "false") {
                                  $$('startupbutton').show(); 
                                  $$('teardownbutton').hide(); 
                                  $$('nullpositionbutton').enable(); 
                                  $$('botisuplabel').define({ label: "Bot is down" });
                              } 
                        });
                    },  10000);

        </script>
    </body>
</html>